<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            color: #333;
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-secondary {
            background: #ecf0f1;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d5dbdb;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .main-container {
            display: flex;
            height: calc(100vh - 76px);
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .sidebar-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            background: #ecf0f1;
            color: #666;
        }

        .tab-btn.active {
            color: white;
        }

        .tab-btn.incidents.active {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .tab-btn.instructions.active {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .items-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .item-card {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .item-card:hover {
            background: #e8f4fc;
        }

        .item-card.active {
            border-color: #3498db;
            background: #e8f4fc;
        }

        .item-card.incident {
            border-left: 4px solid #e74c3c;
        }

        .item-card.instruction {
            border-left: 4px solid #3498db;
        }

        .item-card-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .item-card-meta {
            font-size: 0.85rem;
            color: #888;
        }

        .add-item-btn {
            margin: 15px;
            width: calc(100% - 30px);
            padding: 15px;
            border: 2px dashed #ccc;
            border-radius: 10px;
            background: transparent;
            color: #888;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-item-btn:hover {
            border-color: #3498db;
            color: #3498db;
            background: #e8f4fc;
        }

        /* –†–µ–¥–∞–∫—Ç–æ—Ä */
        .editor {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-empty {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 1.2rem;
        }

        .editor-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .editor-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .editor-section h3 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü—ã */
        .pages-container {
            margin-top: 20px;
        }

        .pages-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            align-items: center;
        }

        .page-tab {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .page-tab:hover {
            border-color: #3498db;
        }

        .page-tab.active {
            background: #3498db;
            border-color: #3498db;
            color: white;
        }

        .add-page-btn {
            padding: 10px 20px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background: transparent;
            cursor: pointer;
            color: #888;
            transition: all 0.3s;
        }

        .add-page-btn:hover {
            border-color: #27ae60;
            color: #27ae60;
        }

        .page-editor {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* –î–µ–π—Å—Ç–≤–∏—è */
        .actions-list {
            margin-top: 15px;
        }

        .action-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .action-number {
            width: 30px;
            height: 30px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .action-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .action-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .action-remove {
            width: 36px;
            height: 36px;
            border: none;
            background: #fee;
            color: #e74c3c;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .action-remove:hover {
            background: #e74c3c;
            color: white;
        }

        .action-drag {
            width: 36px;
            height: 36px;
            border: none;
            background: #f0f0f0;
            color: #888;
            border-radius: 8px;
            cursor: grab;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-action-btn {
            width: 100%;
            padding: 12px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background: transparent;
            color: #888;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .add-action-btn:hover {
            border-color: #27ae60;
            color: #27ae60;
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        .image-upload {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .image-upload:hover {
            border-color: #3498db;
            background: #e8f4fc;
        }

        .image-upload.has-image {
            padding: 10px;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
        }

        .image-upload-text {
            color: #888;
            margin-top: 10px;
        }

        .image-upload-icon {
            font-size: 3rem;
            color: #ccc;
        }

        /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .editor-footer {
            padding: 20px 30px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            padding: 30px;
            animation: modalAppear 0.3s ease;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal h3 {
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        /* –ü—Ä–µ–≤—å—é */
        .preview-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(155, 89, 182, 0.4);
            transition: all 0.3s;
            z-index: 100;
        }

        .preview-btn:hover {
            transform: scale(1.1);
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #2c3e50;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s;
            z-index: 1001;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            background: #27ae60;
        }

        .toast.error {
            background: #e74c3c;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
            }

            .form-row {
                flex-direction: column;
            }
        }

        /* JSON –ø—Ä–µ–≤—å—é */
        .json-preview {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow: auto;
            white-space: pre-wrap;
        }

        .json-key { color: #9cdcfe; }
        .json-string { color: #ce9178; }
        .json-number { color: #b5cea8; }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <header class="header">
        <h1>‚öôÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π</h1>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="showExportModal()">üì§ –≠–∫—Å–ø–æ—Ä—Ç JSON</button>
            <button class="btn btn-secondary" onclick="showImportModal()">üì• –ò–º–ø–æ—Ä—Ç</button>
            <button class="btn btn-success" onclick="saveAll()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë</button>
        </div>
    </header>

    <div class="main-container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-tabs">
                    <button class="tab-btn incidents active" onclick="switchTab('incidents')">üö® –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</button>
                    <button class="tab-btn instructions" onclick="switchTab('instructions')">üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</button>
                </div>
                <input type="text" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫..." oninput="filterList(this.value)">
            </div>
            <div class="items-list" id="items-list"></div>
            <button class="add-item-btn" onclick="addNewItem()">+ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π</button>
        </aside>

        <!-- –†–µ–¥–∞–∫—Ç–æ—Ä -->
        <main class="editor">
            <div class="editor-empty" id="editor-empty">
                <div style="text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üìù</div>
                    <div>–í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è<br>–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π</div>
                </div>
            </div>

            <div class="editor-content" id="editor-content" style="display: none;">
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="editor-section">
                    <h3>üìå –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" class="form-control" id="item-title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ—Ç–µ–∫–ª–∞ —Ä—É–±–∞—à–∫–∞">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>–¢–∏–ø</label>
                            <select class="form-control" id="item-type">
                                <option value="incident">üö® –ò–Ω—Ü–∏–¥–µ–Ω—Ç</option>
                                <option value="instruction">üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ID</label>
                            <input type="text" class="form-control" id="item-id" placeholder="–ê–≤—Ç–æ" readonly>
                        </div>
                    </div>
                </div>

                <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã -->
                <div class="editor-section">
                    <h3>üìÑ –°—Ç—Ä–∞–Ω–∏—Ü—ã</h3>
                    <div class="pages-tabs" id="pages-tabs"></div>
                    <div class="page-editor" id="page-editor"></div>
                </div>
            </div>

            <div class="editor-footer" id="editor-footer" style="display: none;">
                <button class="btn btn-danger" onclick="deleteCurrentItem()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="duplicateItem()">üìã –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn btn-primary" onclick="saveCurrentItem()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </main>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–µ–≤—å—é -->
    <button class="preview-btn" onclick="openPreview()" title="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">üëÅÔ∏è</button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <div class="modal-overlay" id="export-modal">
        <div class="modal" style="max-width: 700px;">
            <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
            <div class="json-preview" id="json-output"></div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('export-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="btn btn-primary" onclick="copyJson()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-success" onclick="downloadJson()">üíæ –°–∫–∞—á–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞ -->
    <div class="modal-overlay" id="import-modal">
        <div class="modal">
            <h3>üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
            <div class="form-group">
                <label>–í—Å—Ç–∞–≤—å—Ç–µ JSON –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</label>
                <textarea class="form-control" id="import-json" rows="10" placeholder='{"incidents": [...], "instructions": [...]}'></textarea>
            </div>
            <input type="file" id="import-file" accept=".json" style="display: none;" onchange="loadFile(event)">
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('import-modal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                <button class="btn btn-primary" onclick="importData()">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal-overlay" id="confirm-modal">
        <div class="modal">
            <h3 id="confirm-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            <p id="confirm-message">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('confirm-modal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-danger" id="confirm-btn">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="toast" id="toast"></div>

    <script>
        // –î–∞–Ω–Ω—ã–µ
        let data = {
            incidents: [
                {
                    id: 1,
                    title: "–ü–æ—Ç–µ–∫–ª–∞ —Ä—É–±–∞—à–∫–∞",
                    pages: [
                        {
                            title: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã",
                            time: "5 –º–∏–Ω—É—Ç",
                            image: "",
                            actions: [
                                "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–Ω–∏—é —Ä–æ–∑–ª–∏–≤–∞",
                                "–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ —É—Ç–µ—á–∫–∏ –≤–∏–∑—É–∞–ª—å–Ω–æ",
                                "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º–µ",
                                "–û—Ü–µ–Ω–∏—Ç—å –æ–±—ä—ë–º —É—Ç–µ—á–∫–∏"
                            ]
                        },
                        {
                            title: "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —É—Ç–µ—á–∫–∏",
                            time: "15 –º–∏–Ω—É—Ç",
                            image: "",
                            actions: [
                                "–ü–µ—Ä–µ–∫—Ä—ã—Ç—å –ø–æ–¥–∞—á—É –≤–æ–¥—ã",
                                "–°–ª–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ –∏–∑ —Ä—É–±–∞—à–∫–∏",
                                "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–∏",
                                "–ó–∞–º–µ–Ω–∏—Ç—å –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –ø—Ä–æ–∫–ª–∞–¥–∫–∏"
                            ]
                        },
                        {
                            title: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫",
                            time: "10 –º–∏–Ω—É—Ç",
                            image: "",
                            actions: [
                                "–û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—á—É –≤–æ–¥—ã",
                                "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—å",
                                "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ü–∏–∫–ª"
                            ]
                        }
                    ]
                },
                {
                    id: 2,
                    title: "–ó–∞—Å—Ç—Ä—è–ª–∞ —ç—Ç–∏–∫–µ—Ç–∫–∞",
                    pages: [
                        {
                            title: "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è",
                            time: "2 –º–∏–Ω—É—Ç—ã",
                            image: "",
                            actions: [
                                "–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –°–¢–û–ü",
                                "–û—Ç–∫—Ä—ã—Ç—å –∑–∞—â–∏—Ç–Ω—ã–π –∫–æ–∂—É—Ö"
                            ]
                        },
                        {
                            title: "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º—è—Ç–∏—è",
                            time: "5 –º–∏–Ω—É—Ç",
                            image: "",
                            actions: [
                                "–£–¥–∞–ª–∏—Ç—å –∑–∞—Å—Ç—Ä—è–≤—à—É—é —ç—Ç–∏–∫–µ—Ç–∫—É",
                                "–û—á–∏—Å—Ç–∏—Ç—å —Ä–æ–ª–∏–∫–∏"
                            ]
                        }
                    ]
                }
            ],
            instructions: [
                {
                    id: 1,
                    title: "–ó–∞–ø—É—Å–∫ –ª–∏–Ω–∏–∏ —Ä–æ–∑–ª–∏–≤–∞",
                    pages: [
                        {
                            title: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞",
                            time: "5 –º–∏–Ω—É—Ç",
                            image: "",
                            actions: [
                                "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–∞—Ä—ã",
                                "–£–±–µ–¥–∏—Ç—å—Å—è –≤ —á–∏—Å—Ç–æ—Ç–µ –ª–∏–Ω–∏–∏"
                            ]
                        },
                        {
                            title: "–ó–∞–ø—É—Å–∫",
                            time: "3 –º–∏–Ω—É—Ç—ã",
                            image: "",
                            actions: [
                                "–í–∫–ª—é—á–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ",
                                "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–≤–µ–π–µ—Ä"
                            ]
                        }
                    ]
                }
            ]
        };

        let currentTab = 'incidents';
        let currentItem = null;
        let currentPageIndex = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            renderItemsList();
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tab) {
            currentTab = tab;
            currentItem = null;
            currentPageIndex = 0;

            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-btn.${tab}`).classList.add('active');

            renderItemsList();
            hideEditor();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞
        function renderItemsList() {
            const list = document.getElementById('items-list');
            const items = data[currentTab];

            list.innerHTML = items.map((item, index) => `
                <div class="item-card ${currentTab === 'incidents' ? 'incident' : 'instruction'} ${currentItem && currentItem.id === item.id ? 'active' : ''}" 
                     onclick="selectItem(${index})">
                    <div class="item-card-title">${item.title}</div>
                    <div class="item-card-meta">üìÑ ${item.pages.length} —Å—Ç—Ä.</div>
                </div>
            `).join('');
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞
        function filterList(query) {
            const items = data[currentTab];
            const filtered = items.filter(item => 
                item.title.toLowerCase().includes(query.toLowerCase())
            );

            const list = document.getElementById('items-list');
            list.innerHTML = filtered.map((item) => {
                const index = items.findIndex(i => i.id === item.id);
                return `
                    <div class="item-card ${currentTab === 'incidents' ? 'incident' : 'instruction'} ${currentItem && currentItem.id === item.id ? 'active' : ''}" 
                         onclick="selectItem(${index})">
                        <div class="item-card-title">${item.title}</div>
                        <div class="item-card-meta">üìÑ ${item.pages.length} —Å—Ç—Ä.</div>
                    </div>
                `;
            }).join('');
        }

        // –í—ã–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
        function selectItem(index) {
            currentItem = { ...data[currentTab][index] };
            currentItem._index = index;
            currentPageIndex = 0;
            showEditor();
            renderItemsList();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä
        function showEditor() {
            document.getElementById('editor-empty').style.display = 'none';
            document.getElementById('editor-content').style.display = 'block';
            document.getElementById('editor-footer').style.display = 'flex';

            document.getElementById('item-title').value = currentItem.title;
            document.getElementById('item-type').value = currentTab === 'incidents' ? 'incident' : 'instruction';
            document.getElementById('item-id').value = currentItem.id;

            renderPagesTabs();
            renderPageEditor();
        }

        // –°–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä
        function hideEditor() {
            document.getElementById('editor-empty').style.display = 'flex';
            document.getElementById('editor-content').style.display = 'none';
            document.getElementById('editor-footer').style.display = 'none';
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–∫–ª–∞–¥–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü
        function renderPagesTabs() {
            const container = document.getElementById('pages-tabs');
            container.innerHTML = currentItem.pages.map((page, index) => `
                <button class="page-tab ${index === currentPageIndex ? 'active' : ''}" onclick="switchPage(${index})">
                    ${index + 1}. ${page.title.substring(0, 15)}${page.title.length > 15 ? '...' : ''}
                </button>
            `).join('') + `
                <button class="add-page-btn" onclick="addPage()">+ –°—Ç—Ä–∞–Ω–∏—Ü–∞</button>
            `;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function switchPage(index) {
            saveCurrentPage();
            currentPageIndex = index;
            renderPagesTabs();
            renderPageEditor();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function renderPageEditor() {
            const page = currentItem.pages[currentPageIndex];
            const container = document.getElementById('page-editor');

            container.innerHTML = `
                <div class="page-header">
                    <h4>–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPageIndex + 1} –∏–∑ ${currentItem.pages.length}</h4>
                    ${currentItem.pages.length > 1 ? `
                        <button class="btn btn-danger btn-sm" onclick="deletePage(${currentPageIndex})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
                    ` : ''}
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</label>
                        <input type="text" class="form-control" id="page-title" value="${page.title}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã">
                    </div>
                    <div class="form-group">
                        <label>–†–µ–≥–ª–∞–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏</label>
                        <input type="text" class="form-control" id="page-time" value="${page.time}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 10 –º–∏–Ω—É—Ç">
                    </div>
                </div>

                <div class="form-group">
                    <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                    <div class="image-upload ${page.image ? 'has-image' : ''}" onclick="document.getElementById('image-input').click()">
                        ${page.image ? `
                            <img src="${page.image}" class="image-preview" alt="Preview">
                            <div class="image-upload-text">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å</div>
                        ` : `
                            <div class="image-upload-icon">üñºÔ∏è</div>
                            <div class="image-upload-text">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
                        `}
                    </div>
                    <input type="file" id="image-input" accept="image/*" style="display: none;" onchange="uploadImage(event)">
                    <input type="text" class="form-control" id="page-image" value="${page.image || ''}" placeholder="–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" style="margin-top: 10px;">
                </div>

                <div class="form-group">
                    <label>–î–µ–π—Å—Ç–≤–∏—è</label>
                    <div class="actions-list" id="actions-list">
                        ${page.actions.map((action, index) => `
                            <div class="action-item">
                                <span class="action-drag">‚ãÆ‚ãÆ</span>
                                <span class="action-number">${index + 1}</span>
                                <input type="text" class="action-input" value="${action}" onchange="updateAction(${index}, this.value)">
                                <button class="action-remove" onclick="removeAction(${index})">√ó</button>
                            </div>
                        `).join('')}
                    </div>
                    <button class="add-action-btn" onclick="addAction()">+ –î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ</button>
                </div>
            `;
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        function saveCurrentPage() {
            if (!currentItem) return;

            const page = currentItem.pages[currentPageIndex];
            const titleEl = document.getElementById('page-title');
            const timeEl = document.getElementById('page-time');
            const imageEl = document.getElementById('page-image');

            if (titleEl) page.title = titleEl.value;
            if (timeEl) page.time = timeEl.value;
            if (imageEl) page.image = imageEl.value;
        }

        // –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
        function addPage() {
            saveCurrentPage();
            currentItem.pages.push({
                title: "–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",
                time: "5 –º–∏–Ω—É—Ç",
                image: "",
                actions: ["–î–µ–π—Å—Ç–≤–∏–µ 1"]
            });
            currentPageIndex = currentItem.pages.length - 1;
            renderPagesTabs();
            renderPageEditor();
        }

        // –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
        function deletePage(index) {
            if (currentItem.pages.length <= 1) {
                showToast('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É', 'error');
                return;
            }

            currentItem.pages.splice(index, 1);
            if (currentPageIndex >= currentItem.pages.length) {
                currentPageIndex = currentItem.pages.length - 1;
            }
            renderPagesTabs();
            renderPageEditor();
        }

        // –î–µ–π—Å—Ç–≤–∏—è
        function addAction() {
            saveCurrentPage();
            currentItem.pages[currentPageIndex].actions.push("–ù–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ");
            renderPageEditor();
        }

        function removeAction(index) {
            saveCurrentPage();
            currentItem.pages[currentPageIndex].actions.splice(index, 1);
            renderPageEditor();
        }

        function updateAction(index, value) {
            currentItem.pages[currentPageIndex].actions[index] = value;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function uploadImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('page-image').value = e.target.result;
                    currentItem.pages[currentPageIndex].image = e.target.result;
                    renderPageEditor();
                };
                reader.readAsDataURL(file);
            }
        }

        // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
        function addNewItem() {
            const newId = Math.max(...data[currentTab].map(i => i.id), 0) + 1;
            const newItem = {
                id: newId,
                title: currentTab === 'incidents' ? "–ù–æ–≤—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç" : "–ù–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è",
                pages: [
                    {
                        title: "–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1",
                        time: "5 –º–∏–Ω—É—Ç",
                        image: "",
                        actions: ["–î–µ–π—Å—Ç–≤–∏–µ 1"]
                    }
                ]
            };

            data[currentTab].push(newItem);
            renderItemsList();
            selectItem(data[currentTab].length - 1);
            showToast('–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç');
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
        function saveCurrentItem() {
            if (!currentItem) return;

            saveCurrentPage();
            currentItem.title = document.getElementById('item-title').value;

            data[currentTab][currentItem._index] = { ...currentItem };
            delete data[currentTab][currentItem._index]._index;

            renderItemsList();
            showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', 'success');
        }

        // –£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç
        function deleteCurrentItem() {
            if (!currentItem) return;

            document.getElementById('confirm-title').textContent = '–£–¥–∞–ª–µ–Ω–∏–µ';
            document.getElementById('confirm-message').textContent = `–£–¥–∞–ª–∏—Ç—å "${currentItem.title}"?`;
            document.getElementById('confirm-btn').onclick = () => {
                data[currentTab].splice(currentItem._index, 1);
                currentItem = null;
                hideEditor();
                renderItemsList();
                closeModal('confirm-modal');
                showToast('–£–¥–∞–ª–µ–Ω–æ');
            };
            document.getElementById('confirm-modal').classList.add('show');
        }

        // –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç
        function duplicateItem() {
            if (!currentItem) return;

            saveCurrentPage();
            const newItem = JSON.parse(JSON.stringify(currentItem));
            newItem.id = Math.max(...data[currentTab].map(i => i.id), 0) + 1;
            newItem.title += ' (–∫–æ–ø–∏—è)';
            delete newItem._index;

            data[currentTab].push(newItem);
            renderItemsList();
            selectItem(data[currentTab].length - 1);
            showToast('–°–æ–∑–¥–∞–Ω–∞ –∫–æ–ø–∏—è');
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë
        function saveAll() {
            if (currentItem) saveCurrentItem();
            localStorage.setItem('knowledgeBase', JSON.stringify(data));
            showToast('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç
        function showExportModal() {
            if (currentItem) saveCurrentPage();
            
            const exportData = {
                incidents: data.incidents.map(i => ({...i})),
                instructions: data.instructions.map(i => ({...i}))
            };

            document.getElementById('json-output').textContent = JSON.stringify(exportData, null, 2);
            document.getElementById('export-modal').classList.add('show');
        }

        function copyJson() {
            const json = document.getElementById('json-output').textContent;
            navigator.clipboard.writeText(json);
            showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
        }

        function downloadJson() {
            const json = document.getElementById('json-output').textContent;
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'knowledge-base.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('–§–∞–π–ª —Å–∫–∞—á–∞–Ω', 'success');
        }

        // –ò–º–ø–æ—Ä—Ç
        function showImportModal() {
            document.getElementById('import-json').value = '';
            document.getElementById('import-modal').classList.add('show');
        }

        function loadFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('import-json').value = e.target.result;
                };
                reader.readAsText(file);
            }
        }

        function importData() {
            try {
                const json = document.getElementById('import-json').value;
                const imported = JSON.parse(json);

                if (imported.incidents) data.incidents = imported.incidents;
                if (imported.instructions) data.instructions = imported.instructions;

                currentItem = null;
                hideEditor();
                renderItemsList();
                closeModal('import-modal');
                showToast('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
            } catch (e) {
                showToast('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ JSON', 'error');
            }
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function closeModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // –ü—Ä–µ–≤—å—é
        function openPreview() {
            if (currentItem) saveCurrentPage();
            localStorage.setItem('previewData', JSON.stringify(data));
            window.open('incidents.html', '_blank');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        const saved = localStorage.getItem('knowledgeBase');
        if (saved) {
            try {
                data = JSON.parse(saved);
                renderItemsList();
            } catch (e) {}
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('show');
                }
            });
        });
    </script>
</body>
</html>
